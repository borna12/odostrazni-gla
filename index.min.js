lista = []
$.get('natuknice.txt', function(data) {
    lista = data.split("\n");
}, 'text');
var pritisak = 1;
$(function() {
    function removeAccents(string) {
        const accents =
            "ÀÁÂÃÄÅàáȃâãäåāȁßÒÓÔÕÕÖØòóôõöøȏōȍÈÉÊËèéëēȅÇçÐÌÍÎÏìíîïīȋȉÙÚÛÜùúüūȕȗÑñŸÿýȑȓr̀r̂ŕr̄'’";
        const accentsOut =
            "AAAAAAaaaaaaaaaBOOOOOOOoooooooooEEEEeeeeeCcDIIIIiiiiiiiUUUUuuuuuuNnYyyrrrrrr  ";
        return string
            .split("")
            .map((letter, index) => {
                const accentIndex = accents.indexOf(letter);
                return accentIndex !== -1 ? accentsOut[accentIndex] : letter;
            })
            .join("");
    }

    function e() {
        for (listic = 0; listic < lista.length; listic++) { lista[listic] = lista[listic].replace(/(\r\n|\n|\r)/gm, ""); }
        var element = $('.prikazi'); //convert string to JQuery element
        element.find("span").each(function(index) {
            var text = $(this).text(); //get span content
            $(this).replaceWith(text); //replace all span with just content
        });
        var newString = element.html()

        $("li").removeClass();
        1 == pritisak && ($.each(lista, function(e, n) {
                if (n.indexOf(' ') !== -1) {
                    n = n.split(" ")
                    dodati = ""
                    for (var i = 0; i < n.length; i++) {
                        dodati += '<div>' + n[i] + '</div> '
                    }
                    dodati += ' – '
                    for (var i = 0; i < n.length; i++) {
                        dodati += '<div class="gla">' + n[i] + '</div> '
                    }
                    $("#JSONunorderedList").append($("<li>").html(dodati.slice(0, -1)))

                } else {
                    $("#JSONunorderedList").append($("<li>").html("<div>" + n + "</div> – <div class='gla'>" + n + "</div>"))
                }

            }), pritisak = 2),
            function() {
                var e, n, i, t;
                for (e = document.getElementById("filter").value.toUpperCase(), duljina = e.length, n = document.getElementById("JSONunorderedList").getElementsByTagName("li"), t = 0; t < n.length; t++)
                    
                    for (y = 0; y < n[t].getElementsByTagName("div").length; y++) {
                        i = n[t].getElementsByTagName("div")[y]
                        if(e.toLowerCase().includes('ê'))
                        {rijec = i.innerHTML.toUpperCase().slice(-duljina)}
                        else{rijec = removeAccents(i.innerHTML).toUpperCase().slice(-duljina)}
                            
                        if("" == e) {
                            $(li).removeClass("sakri")
                            $(li).addClass("prikazi")
                        }
                        else if (rijec == e) {
                            //alert(rijec + " " + e + " " + i.innerHTML + " radi")
                            n[t].classList.add("prikazi");
                            break
                        } else {
                            n[t].classList.add("sakri")
                        }
                    }

                var x = document.getElementsByClassName("prikazi");
                $("#rez").html("Pronađen broj riječi: " + x.length + ".")
                var br;
                var x = document.getElementsByClassName("prikazi");
                for (br = 0; br < x.length; br++) {
                    pozicija=x[br].innerHTML.toUpperCase().indexOf(e)
                    redak=x[br].innerHTML
                    if (redak.includes(" ")){
                        pozicije=redak.split(e.toLowerCase()+"</div>")
                        x[br].innerHTML=pozicije.join("<span>"+redak.slice(pozicija,pozicija+e.length)+"</div></span>")}
                        
                    else{
                    pozicije=redak.split(e.toLowerCase())
                    x[br].innerHTML=pozicije.join("<span>"+redak.slice(pozicija,pozicija+e.length)+"</span>")}
                }
            }()
        document.getElementById("JSONunorderedList").scrollIntoView();
       /* $(".prikazi").click(function() {
            adresa = removeAccents($(this).text().replace("ć", "c").replace("č", "c").replace("ž", "z").replace("š", "s").replace("đ", "d"))
            window.open('https://rjecnik.hr/mreznik/index.php/' + adresa, "_blank");
        })*/
    }
    $(document).keydown(function(e) {
        return 123 !== e.which && void 0
    }), $("#nadi").on("click", function() {
        var inputField = $("#filter");
        var text = inputField.val();
        inputField.val(text.replace(/ć/g, "ĉ")); // Replace 'ć' with 'ĉ'
        e();
        
        0 == $("#JSONunorderedList").children(":visible").length ? $("#poruka").show() : $("#poruka").hide()
    }), $("#filter").keydown(function(n) {
        if (13 == n.keyCode) {
            $("#nadi").click()
        }
    })

     // **ADDED CODE START**
     $("#filter").on("input", function() {
        $("#glagolj-prikaz").text($(this).val());
    });
    // **ADDED CODE END**


}), $("input").focus(function() {}), $(".player-position li").on("click", function(e) {
    $(".available-player>." + e.target.classList[0]).show().siblings().hide()
});
var selector = ".available-player li";
$(selector).on("click", function() {
    $(this).parent().find("li").removeClass("active"), $(this).parent().find("li").removeClass("current"), $(this).addClass("active")
});

// **ADDED CODE START**
function unesi() {
    var inputField = document.getElementById("filter");
    var character = event.target.innerHTML; // Get the text of the clicked button
    if (character.length > 1) {
        character = character[0]; // Ensure we only insert ONE character
    }
    var cursorPosition = inputField.selectionStart; // Get the cursor position

    // Insert the character at the cursor position
    var textBefore = inputField.value.substring(0, cursorPosition);
    var textAfter = inputField.value.substring(cursorPosition);
    inputField.value = textBefore + character + textAfter;

    // Move the cursor to the right after inserting the character
    inputField.selectionStart = inputField.selectionEnd = cursorPosition + character.length;

    // Update the live preview
    $("#glagolj-prikaz").text(inputField.value);

    // Focus back to the input field
    inputField.focus();
}
// **ADDED CODE END**
